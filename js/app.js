!function e(t,i,a){function n(s,o){if(!i[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(r)return r(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=i[s]={exports:{}};t[s][0].call(c.exports,function(e){var i=t[s][1][e];return n(i||e)},c,c.exports,e,t,i,a)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<a.length;s++)n(a[s]);return n}({1:[function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e){requestAnimationFrame(n),u.renderLoop(e),c.renderer.render(c.scene,c.camera),p&&m.update(c.renderer)}var r=e("./modules/view"),s=e("./modules/game-engine"),o=a(s),l=e("./modules/game-view"),h=a(l),c=void 0,d=void 0,u=void 0,m=void 0,p=!0;!function(){var e=(0,r.setupScreenView)(),t=e.scene,i=e.camera,a=e.renderer;c={scene:t,camera:i,renderer:a},p&&(m=(0,r.setupPerformance)()),d=new o.default(c),u=new h.default(c,d),n()}()},{"./modules/game-engine":6,"./modules/game-view":7,"./modules/view":11}],2:[function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),r=e("./constants");Array.prototype.unique=function(){return this.filter(function(e,t,i){return i.indexOf(e)===t})};var s=function(){function e(t){a(this,e),this.determineAIFunction(t.personality),this.player=t.player,this.spawnInterval=400,this.lastSpawn=0,this.poppulationLimit=15}return n(e,[{key:"canSpawn",value:function(e){return e-this.lastSpawn>this.spawnInterval}},{key:"runLoop",value:function(e,t){if(this.canSpawn(e)){var i=this.AIFunction(t,this.player.minions);i>=0&&this.player.minions.length<this.poppulationLimit&&(this.player.spawnMinion(i),this.lastSpawn=e)}}},{key:"randomAI",value:function(e){return Math.floor(Math.random()*r.gridSubDiv)}},{key:"nicksAI",value:function(e,t){for(var i=this.player.spawnPos,a=t.map(function(e){return{row:e.startingZ,distance:e.getPosition().x-i}}),n=e.map(function(e){var t=i-e.getPosition().x;return{row:e.startingZ,distance:t}}),s=[],o=0;o<r.gridSubDiv;o++)s.push(o);var l={hasFriendlies:[],closestIndex:-1,closestVal:99999,distanceTies:[]};a.forEach(function(e,t){l.hasFriendlies.push(e.row)}),n.forEach(function(e,t){e.distance<l.closestVal?(l.closestIndex=e.row,l.closestVal=e.distance,l.distanceTies.length>0&&(l.distanceTies.length=0)):e.distance===l.closestVal&&l.distanceTies.push(e.row)}),l.distanceTies.push(l.closestIndex),l.hasFriendlies=l.hasFriendlies.unique();var h=s.slice(0);l.gaps=h.filter(function(e){return l.hasFriendlies.indexOf(e)<0});var c=void 0;return c=l.closestVal<r.gridWidth/2?l.distanceTies:l.gaps,c[Math.floor(Math.random()*c.length)]}},{key:"defensiveAI",value:function(e){for(var t={},i=0;i<r.gridSubDiv;i++)t[i]=0;e.forEach(function(e){t[e.startingZ]--}),this.player.minions.forEach(function(e){t[e.startingZ]++});var a=-1,n=1e5;return Object.values(t).forEach(function(e,t){e<n&&(n=e,a=t)}),a}},{key:"determineAIFunction",value:function(e){this.AIFunction=e?this[e]:this.randomAI}}]),e}();i.default=s},{"./constants":5}],3:[function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),r=e("./constants"),s=function(e){return e&&e.__esModule?e:{default:e}}(r),o=function(){function e(t){a(this,e),this.scene=t.scene,this.player=t.player,this.playerId=this.player.id,this.colliderList=t.colliderList,this.direction=t.direction,this.startingZ=t.startingZ,this.startingY=t.startingY+4,this.startingX=t.startingX-4*this.direction,this.targetList=[],this.arrows=[],this.startingRotation=0;var i=.5*Math.PI,n=.75*Math.PI;this.animationProperties={arm:{startingAngle:n,endingAngle:i,angleDifference:n-i,speedDown:200,speedUp:150,lastAnimate:null},arrowSpeed:500},this.attackProperties={lastAttack:0},this.attackSpeed=s.default.archer.baseAttackSpeed,this.arrowSpeed=s.default.archer.baseArrowSpeed,this.attackStrength=s.default.archer.baseAttack,this.arrowId=0,this.initializeView(),this.registerCollision()}return n(e,[{key:"initializeView",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.viewObj=new THREE.Group;var t=new THREE.BoxGeometry(.01,.013,.013),i=new THREE.MeshBasicMaterial({color:65280});this.body=new THREE.Mesh(t,i);var a=new THREE.BoxGeometry(60,60,60),n=new THREE.MeshBasicMaterial({color:16776960,transparent:!0,opacity:e,depthWrite:!1});this.hitBox=new THREE.Mesh(a,n),this.hitBox.userData.player=this.player,this.hitBox.userData.object=this,this.hitBox.userData.ranged=!0,this.viewObj.add(this.body),this.viewObj.add(this.hitBox),this.viewObj.position.set(this.startingX,this.startingY,this.startingZ)}},{key:"registerCollision",value:function(){var e=this;this.hitBox.geometry.computeBoundingBox();var t=this.hitBox.geometry.boundingBox.clone();this.collider=new THREEx.ColliderBox3(this.hitBox,t),this.colliderList.push(this.collider),this.collider.addEventListener("contactEnter",function(t){var i=t.object3d.userData;i.player.id!==e.playerId&&(i.ranged||i.immuneToRange||e.targetList.push(i.object))}),this.collider.addEventListener("contactStay",function(t){var i=t.object3d.userData;i.player.id!==e.playerId&&(i.ranged||i.immuneToRange||e.findColliderIndex(t.id)===-1&&e.targetList.push(i.object))}),this.collider.addEventListener("contactRemoved",function(t){e.targetList.splice(e.findColliderIndex(t),1),e.determineTarget()}),this.collider.addEventListener("contactExit",function(t){e.removeTarget(t),e.determineTarget()})}},{key:"findColliderIndex",value:function(e){for(var t=-1,i=0;i<this.targetList.length;i++)this.targetList[i].collider.id===e&&(t=i);return t}},{key:"removeTarget",value:function(e){this.targetList.splice(this.findColliderIndex(e),1)}},{key:"canAttack",value:function(e){return 0!==this.targetList.length&&(!this.initiateAttack&&!this.recharging&&e-this.attackProperties.lastAttack>=this.attackSpeed)}},{key:"getAttackValue",value:function(){return this.attackStrength}},{key:"determineTarget",value:function(){return this.targetList.length>0?this.targetList[0]:null}},{key:"attackProcedure",value:function(e){var t=this;if(this.canAttack(e)){var i=this.determineTarget();null!==i&&i.viewObj&&(this.nextTarget={target:i,callback:function(e){e.health-=t.getAttackValue(),e.health<=0&&(t.player.processReward(e.killReward),e.attack=!1,e.destroy=!0,t.removeTarget(e.collider.id))}},this.initiateAttack=!0),this.attackProperties.lastAttack=e}}},{key:"spawnArrow",value:function(e,t,i){var a=this,n=new THREE.SphereGeometry(1,10,10),r=new THREE.MeshBasicMaterial({color:10237732}),s=new THREE.Mesh(n,r);s.name="Arrow",this.scene.add(s),s.position.set(this.startingX,this.startingY+2,this.startingZ);var o=this.arrowId++,l=s.position.y,h=l+5,c=e.viewObj.position.y,d=l,u=h,m=c,p=d/.5+u/-.25+m/.5,g=1.5*-d/.5-1*u/-.25-.5*m/.5,f=.5*d*1/.5+0*u*1/-.25+0*m*.5/.5,y=function(e){return p*(e*e)+g*e+f},v=e.viewObj.position.x-s.position.x,w=s.position.x,k=function(e){return v*e+w},E=e.viewObj.position.z-s.position.z,b=s.position.z,B=function(e){return E*e+b};this.arrows.push({id:o,obj:s,target:e,startingTime:t,yFunction:y,xFunction:k,zFunction:B}),setTimeout(function(){i(e),a.arrows=a.arrows.filter(function(e){return e!==o}),a.scene.remove(s)},this.arrowSpeed)}},{key:"animateArrows",value:function(e){var t=this;this.arrows.forEach(function(i){var a=(e-i.startingTime)/t.arrowSpeed;i.obj.position.y=i.yFunction(a),i.obj.position.x=i.xFunction(a),i.obj.position.z=i.zFunction(a)})}},{key:"animateAttack",value:function(e){if(this.rightArm&&this.initiateAttack)if(this.rightArm.rotation.z>this.animationProperties.arm.endingAngle){null===this.animationProperties.arm.lastAnimate&&(this.animationProperties.arm.lastAnimate=e);var t=e-this.animationProperties.arm.lastAnimate,i=t/this.animationProperties.arm.speedDown,a=this.animationProperties.arm.angleDifference*i;this.rightArm.rotation.z-=a,this.animationProperties.arm.lastAnimate=e}else this.spawnArrow(this.nextTarget.target,e,this.nextTarget.callback),this.resetAttackAnimation();if(this.rightArm&&this.recharging)if(this.rightArm.rotation.z<this.animationProperties.arm.startingAngle){null===this.animationProperties.arm.lastAnimate&&(this.animationProperties.arm.lastAnimate=e);var n=e-this.animationProperties.arm.lastAnimate,r=n/this.animationProperties.arm.speedUp,s=this.animationProperties.arm.angleDifference*r;this.rightArm.rotation.z+=s,this.animationProperties.arm.lastAnimate=e}else this.recharging=!1,this.animationProperties.arm.lastAnimate=null;if(this.nextTarget&&this.nextTarget.target){var o=this.calculateAngleToTarget(this.nextTarget.target);this.bodyModel.rotation.y=o+this.startingRotation}}},{key:"resetAttackAnimation",value:function(){this.initiateAttack=!1,this.recharging=!0,this.animationProperties.arm.lastAnimate=null}},{key:"calculateAngleToTarget",value:function(e){var t=e.viewObj.position.x-this.viewObj.position.x,i=e.viewObj.position.z-this.viewObj.position.z,a=i/t;return Math.PI*-this.direction-Math.atan(a)+Math.PI}},{key:"runLoop",value:function(e){this.attackProcedure(e),this.animateArrows(e),this.animateAttack(e),this.collider.update()}}]),e}();i.default=o},{"./constants":5}],4:[function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),r=e("./constants"),s=function(){function e(t){a(this,e),this.direction=t.direction,this.colliderList=t.colliderList,this.player=t.player,this.playerId=this.player.id,this.baseWidth=r.gridWidth,this.baseHeight=20,this.baseDepth=10,this.maxHealth=250,this.health=this.maxHealth,this.hitBoxBuffer=2,this.killReward={money:550,score:1e3},this.initializeView(this.direction),this.registerCollision()}return n(e,[{key:"initializeView",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.viewObj=new THREE.Group;var i=new THREE.BoxGeometry(this.baseDepth,this.baseHeight,this.baseWidth),a=new THREE.TextureLoader,n=a.load("textures/rock-normal-map.jpg"),s=a.load("textures/brick-wall.jpg"),o=a.load("textures/brick-wall.jpg"),l=a.load("textures/brick-wall.jpg");s.wrapS=s.wrapT=THREE.RepeatWrapping,s.repeat.set(3,1),o.wrapS=o.wrapT=THREE.RepeatWrapping,o.repeat.set(1,3),l.wrapS=l.wrapT=THREE.RepeatWrapping,l.repeat.set(1,1);var h=new THREE.MeshPhongMaterial({color:3355443,specular:3355443,shininess:15,normalMap:a.load("textures/rock-normal-map.jpg"),normalScale:new THREE.Vector2(.05,1),map:o}),c=new THREE.MeshPhongMaterial({color:5592405,specular:3355443,shininess:15,normalMap:n,normalScale:new THREE.Vector2(1,1),map:s}),d=new THREE.MeshPhongMaterial({color:5592405,specular:3355443,shininess:15,normalMap:n,normalScale:new THREE.Vector2(1,1),map:l}),u=[c,c,h,d,d,h],m=new THREE.Mesh(i,new THREE.MultiMaterial(u)),p=new THREE.BoxGeometry(this.baseDepth+this.hitBoxBuffer,this.baseHeight+this.hitBoxBuffer,this.baseWidth+this.hitBoxBuffer),g=new THREE.MeshBasicMaterial({color:65535,transparent:!0,opacity:t}),f=new THREE.Mesh(p,g);this.healthBar=this.initializeHealthBar(),this.hitBox=f,this.viewObj.add(m),this.viewObj.add(f),this.viewObj.add(this.healthBar),this.viewObj.position.x=(-r.gridWidth/2-this.baseDepth/2)*this.direction,this.viewObj.position.y=this.baseHeight/2,this.hitBox.userData.object=this,this.hitBox.userData.player=this.player,this.hitBox.userData.immuneToRange=!0}},{key:"initializeHealthBar",value:function(){this._healthBarLength=r.gridWidth/10,this._healthBarWidth=r.gridWidth/150;var e=new THREE.BoxGeometry(this._healthBarLength,this._healthBarWidth,this._healthBarWidth),t=new THREE.MeshBasicMaterial({color:65280}),i=new THREE.Mesh(e,t);i.name="FullHealthBar";var a=new THREE.BoxGeometry(.99*this._healthBarLength,.9*this._healthBarWidth,.9*this._healthBarWidth),n=new THREE.MeshBasicMaterial({color:16711680}),s=new THREE.Mesh(a,n);s.name="EmptyHealthBar";var o=new THREE.Group;return o.add(i),o.add(s),o.position.y=this.baseHeight+5,o}},{key:"updateHealthBar",value:function(){var e=this.health/this.maxHealth,t=-(1-e)*this._healthBarLength/2,i=this.healthBar.getObjectByName("FullHealthBar");i.scale.x=e,i.position.x=t}},{key:"registerCollision",value:function(){this.hitBox.geometry.computeBoundingBox();var e=this.hitBox.geometry.boundingBox.clone();this.collider=new THREEx.ColliderBox3(this.hitBox,e),this.colliderList.push(this.collider)}},{key:"runLoop",value:function(){this.collider.update(),this.updateHealthBar()}}]),e}();i.default=s},{"./constants":5}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var a=(i.xPositive=1,i.xNegative=-1,i.gridWidth=64,i.gridSubDiv=16,{baseHealth:10,baseAttack:3,baseAttackSpeed:1e3,upgrades:{health:{cost:50,amount:5},attack:{cost:75,amount:2},attackSpeed:{cost:100,amount:10}}}),n={baseHealth:250,upgrades:{health:{cost:150,amount:250}}},r={baseAttack:1,baseAttackSpeed:1e3,baseArrowSpeed:1e3,upgrades:{attack:{cost:50,amount:1},attackSpeed:{cost:100,amount:10}}},s={};i.default={minion:a,base:n,archer:r,player:s}},{}],6:[function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),s=e("./player"),o=a(s),l=e("./ai-player"),h=(a(l),e("./menu-screen")),c=e("./constants"),d=function(){function e(t){n(this,e),this.gameOver=!0,this.state={},this.scene=t.scene,this.camera=t.camera,this.colliderSystem=new THREEx.ColliderSystem,this.colliderList=[],this.playerId=0,this.initializePlayers()}return r(e,[{key:"initializePlayers",value:function(){this.myPlayer=new o.default({type:"human",direction:c.xPositive,colliderList:this.colliderList,colliderSystem:this.colliderSystem,scene:this.scene,id:this.playerId++}),this.computer=new o.default({type:"computer",direction:c.xNegative,colliderList:this.colliderList,colliderSystem:this.colliderSystem,scene:this.scene,id:this.playerId++}),this.state.players=[this.myPlayer,this.computer]}},{key:"initializeGameOver",value:function(e){var t=e.winner,i=e.score;this.state.players.forEach(function(e){return e.setGameOver()}),(0,h.activateMenu)({winner:t,score:i})}},{key:"restart",value:function(){for(;this.colliderList.length>0;)this.colliderList.pop();this.state.players.forEach(function(e){e.reset()}),this.gameOver=!1}},{key:"gameLoop",value:function(e){var t=this;this.gameOver,this.AI&&this.AI.runLoop(e,this.myPlayer.minions),this.playerAI&&this.playerAI.runLoop(e,this.computer.minions),this.state.players.forEach(function(i){if(i.runLoop(e),i.lost&&!t.gameOver){t.gameOver=!0;var a=t.state.players.find(function(e){return e.id!==i.id}),n=a.score;t.initializeGameOver({winner:a,score:n})}}),this.colliderSystem.computeAndNotify(this.colliderList)}}]),e}();i.default=d},{"./ai-player":2,"./constants":5,"./menu-screen":8,"./player":10}],7:[function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),r=e("./constants"),s=function(e){return e&&e.__esModule?e:{default:e}}(r),o=e("./menu-screen"),l=void 0,h=void 0,c=void 0,d=void 0,u=void 0,m=void 0,p=void 0,g=void 0,f=void 0,y=void 0,v=void 0,w=void 0,k=void 0,E=void 0,b=void 0,B=(new THREE.TextureLoader).load("textures/stone.jpg");B.repeat.set(10,10),B.wrapS=THREE.RepeatWrapping,B.wrapT=THREE.RepeatWrapping;var P=function(){function e(t,i){a(this,e),this.scene=t.scene,this.camera=t.camera,this.renderer=t.renderer,this.gameEngine=i,this.setupGrid(),this.setupGrassField(),this.setupLight(),this.mouse={x:-1e4,y:0};var n=r.gridWidth/2;this.camera.position.z=2*n,this.camera.position.y=1.5*n,this.camera.lookAt(this.scene.position),this.hud=document.getElementById("hud"),this.hudUpgrade=document.getElementById("hud-upgrade"),this.lastTimeStamp=0,this.started=!1,this.raycaster=new THREE.Raycaster,this.currentHoveredPanel=null,this.setupMouseEvent(),(0,o.bindButtons)(this,this.gameEngine)}return n(e,[{key:"setupLight",value:function(){var e=new THREE.AmbientLight(6710886,3),t=new THREE.PointLight(8947848,1);t.position.set(0,30,0),e.position.set(0,30,0),this.scene.add(e),this.scene.add(t)}},{key:"setupGrid",value:function(){var e=new THREE.GridHelper(r.gridWidth,r.gridSubDiv);e.position.y=-.4,this.scene.add(e),this.gridPanels={};for(var t=r.gridWidth/r.gridSubDiv,i=(r.gridWidth/2-t/2)*-1,a=0;a<r.gridSubDiv;a++){var n=new THREE.PlaneGeometry(r.gridWidth,t),s=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),o=new THREE.Mesh(n,s);o.rotation.x=-.5*Math.PI,o.position.z=i,o.position.y=0,this.scene.add(o),this.gridPanels[a]=o,i+=t}}},{key:"setupGrassField",value:function(){var e=(new THREE.TextureLoader).load("textures/grasslight-small.jpg");e.wrapS=THREE.RepeatWrapping,e.wrapT=THREE.RepeatWrapping,e.repeat.y=r.gridSubDiv,e.repeat.x=r.gridSubDiv,e.anisotropy=this.renderer.getMaxAnisotropy();var t=new THREE.PlaneGeometry(10*r.gridWidth,10*r.gridWidth),i=new THREE.MeshPhongMaterial({map:e,shininess:10}),a=new THREE.Mesh(t,i);a.rotateX(-Math.PI/2),a.position.y=-.2,this.scene.add(a)}},{key:"checkGridIntersections",value:function(){this.raycaster.setFromCamera(this.mouse,this.camera);var e=Object.values(this.gridPanels),t=this.raycaster.intersectObjects(e);if(e.forEach(function(e){e.material.color.setHex(6710886),e.material.opacity=0}),t.length>0){var i=t[0].object;i.material.color.setHex(16711680),i.material.opacity=.5,this.currentHoveredPanel=i}else this.currentHoveredPanel&&(this.currentHoveredPanel=null)}},{key:"getCurrentPanelIndex",value:function(){if(this.currentHoveredPanel)for(var e=Object.values(this.gridPanels),t=0;t<r.gridSubDiv;t++)if(this.currentHoveredPanel===e[t])return t}},{key:"setupMouseEvent",value:function(){var e=this.mouse;window.addEventListener("mousemove",function(t){e.x=event.clientX/window.innerWidth*2-1,e.y=2*-(event.clientY/window.innerHeight)+1})}},{key:"startFirstGame",value:function(){var e=this;this.gameEngine.restart(),this.hud.classList.remove("hud--hidden"),this.hudUpgrade.classList.remove("hud--hidden"),this.initializeUpgradeButtons(),this.initializeHudTexts(),this.started=!0,window.addEventListener("click",function(){var t=e.getCurrentPanelIndex();t>=0&&e.gameEngine.myPlayer.spawnMinion(t)}),window.addEventListener("keypress",function(){var t=e.getCurrentPanelIndex();t>=0&&e.gameEngine.computer.spawnMinion(t)})}},{key:"calculateFPS",value:function(e){var t=e-this.lastTimeStamp;return t/=1e3,this.lastTimeStamp=e,Math.round(1/t)}},{key:"updateUI",value:function(e){l.textContent=this.gameEngine.myPlayer.score,h.textContent=this.gameEngine.myPlayer.money,c.textContent=this.calculateFPS(e),null!==this.gameEngine.myPlayer.base?d.textContent=Math.max(this.gameEngine.myPlayer.base.health,0).toFixed(2)+" / "+this.gameEngine.myPlayer.base.maxHealth:d.textContent="0",u.textContent=s.default.minion.baseHealth+s.default.minion.upgrades.health.amount*this.gameEngine.myPlayer.upgrades.minionBaseHealth,m.textContent=s.default.minion.baseAttack+s.default.minion.upgrades.attack.amount*this.gameEngine.myPlayer.upgrades.minionBaseAttack,p.textContent=((s.default.minion.baseAttackSpeed+this.gameEngine.myPlayer.upgrades.minionBaseAttackSpeed*-s.default.minion.upgrades.attackSpeed.amount)/1e3).toFixed(2)+"s",g.textContent=s.default.archer.baseAttack+this.gameEngine.myPlayer.upgrades.archerBaseAttack*s.default.archer.upgrades.attack.amount,f.textContent=((s.default.archer.baseAttackSpeed-this.gameEngine.myPlayer.upgrades.archerBaseAttackSpeed*s.default.archer.upgrades.attackSpeed.amount)/1e3).toFixed(2)+"s"}},{key:"renderLoop",value:function(e){this.checkGridIntersections(),this.gameEngine.gameLoop(e),this.started&&this.updateUI(e)}},{key:"initializeHudTexts",value:function(){l=document.getElementById("score"),h=document.getElementById("money"),c=document.getElementById("fps"),d=document.getElementById("baseHealth"),u=document.getElementById("minionBaseHealth"),m=document.getElementById("minionBaseAttack"),p=document.getElementById("minionBaseAttackSpeed"),g=document.getElementById("archerBaseAttack"),f=document.getElementById("archerBaseAttackSpeed")}},{key:"initializeUpgradeButtons",value:function(){var e=this;y=document.getElementById("baseHealthUpgrade"),y.addEventListener("click",function(){e.gameEngine.myPlayer.money>s.default.base.upgrades.health.cost&&(e.gameEngine.myPlayer.base.maxHealth+=s.default.base.upgrades.health.amount,e.gameEngine.myPlayer.base.health+=s.default.base.upgrades.health.amount,e.gameEngine.myPlayer.money-=s.default.base.upgrades.health.cost)}),v=document.getElementById("minionBaseHealthUpgrade"),v.addEventListener("click",function(){e.gameEngine.myPlayer.money>s.default.minion.upgrades.health.cost&&(e.gameEngine.myPlayer.upgrades.minionBaseHealth++,e.gameEngine.myPlayer.money-=s.default.minion.upgrades.health.cost)}),w=document.getElementById("minionBaseAttackUpgrade"),w.addEventListener("click",function(){e.gameEngine.myPlayer.money>s.default.minion.upgrades.attack.cost&&(e.gameEngine.myPlayer.upgrades.minionBaseAttack++,e.gameEngine.myPlayer.money-=s.default.minion.upgrades.attack.cost)}),k=document.getElementById("minionBaseAttackSpeedUpgrade"),k.addEventListener("click",function(){e.gameEngine.myPlayer.money>s.default.minion.upgrades.attackSpeed.cost&&(e.gameEngine.myPlayer.upgrades.minionBaseAttackSpeed++,e.gameEngine.myPlayer.money-=s.default.minion.upgrades.attackSpeed.cost)}),E=document.getElementById("archerBaseAttackUpgrade"),E.addEventListener("click",function(){e.gameEngine.myPlayer.money>s.default.archer.upgrades.attack.cost&&(e.gameEngine.myPlayer.archers.forEach(function(e){e.attackStrength+=s.default.archer.upgrades.attack.amount}),e.gameEngine.myPlayer.upgrades.archerBaseAttack++,e.gameEngine.myPlayer.money-=s.default.archer.upgrades.attack.cost)}),b=document.getElementById("archerBaseAttackSpeedUpgrade"),b.addEventListener("click",function(){e.gameEngine.myPlayer.money>s.default.archer.upgrades.attackSpeed.cost&&(e.gameEngine.myPlayer.archers.forEach(function(e){e.attackSpeed-=s.default.archer.upgrades.attackSpeed.amount,e.arrowSpeed-=s.default.archer.upgrades.attackSpeed.amount}),e.gameEngine.myPlayer.upgrades.archerBaseAttackSpeed++,e.gameEngine.myPlayer.money-=s.default.archer.upgrades.attackSpeed.cost)})}}]),e}();i.default=P},{"./constants":5,"./menu-screen":8}],8:[function(e,t,i){"use strict";function a(){h.classList.add("modal--visible"),d.classList.remove("modal--visible")}function n(e,t){var i="Player "+(e.id+1)+" wins with a score of "+t+"!";m.textContent=i,h.classList.remove("modal--visible"),d.classList.add("modal--visible")}function r(e){l.classList.add("modal--visible"),null!==e.winner?n(e.winner,e.score):a()}function s(e){l.classList.remove("modal--visible")}function o(e,t){c.addEventListener("click",function(){e.startFirstGame(),s()}),u.addEventListener("click",function(){t.restart(),s()})}Object.defineProperty(i,"__esModule",{value:!0}),i.activateMenu=r,i.closeMenu=s,i.bindButtons=o;var l=document.getElementById("modal"),h=document.getElementById("startModal"),c=document.getElementById("startButton"),d=document.getElementById("restartModal"),u=document.getElementById("restartButton"),m=document.getElementById("restartModalMessage")},{}],9:[function(e,t,i){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),r=e("./constants"),s=function(e){return e&&e.__esModule?e:{default:e}}(r),o=function(){function e(t){a(this,e),this.direction=t.direction,this.colliderList=t.colliderList,this.id=t.id,this.playerId=t.playerId,this.player=t.player,this.startingZ=t.startingZ,this.scene=t.scene,this.maxHealth=s.default.minion.baseHealth+t.healthUpgrade*s.default.minion.upgrades.health.amount,this.attackStrength=s.default.minion.baseAttack+t.attackUpgrade*s.default.minion.upgrades.attack.amount,this.attackSpeed=s.default.minion.baseAttackSpeed+t.attackSpeedUpgrade*-s.default.minion.upgrades.attackSpeed.amount,this.defaultSpeed=.3,this.health=this.maxHealth,this.speed=this.defaultSpeed,this.attackProperties={lastTimeStamp:null,attackTime:0},this.attackAnimationProperties={direction:1,speed:this.attackSpeed/2},this.walkingAnimationProperties={direction:this.direction,speed:50/this.defaultSpeed,lastTimeStamp:null,time:0},this.killReward={money:75,score:25},this.destroy=!1,this.attack=!1,this.rotObjectMatrix=null,this.initializeView(this.startingZ),this.registerCollision()}return n(e,[{key:"initializeView",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.viewObj=new THREE.Group;var i=new THREE.BoxGeometry(3,8,3),a=new THREE.MeshBasicMaterial({color:65535,transparent:!0,opacity:t}),n=new THREE.Mesh(i,a);this.healthBar=this.initializeHealthBar(),n.add(this.healthBar),this.viewObj=n,this.hitBox=this.viewObj;var s=e*(r.gridWidth/r.gridSubDiv)-r.gridWidth/2+r.gridWidth/r.gridSubDiv/2,o=r.gridWidth/2*-this.direction;this.viewObj.position.z=s,this.viewObj.position.x=o,this.viewObj.position.y=4,this.hitBox.userData.object=this,this.hitBox.userData.player=this.player,i.dispose(),a.dispose()}},{key:"getPosition",value:function(){return this.viewObj.position}},{key:"initializeHealthBar",value:function(){this._healthBarWidth=2;var e=new THREE.BoxGeometry(this._healthBarWidth,.3,.3),t=new THREE.MeshBasicMaterial({color:65280}),i=new THREE.Mesh(e,t);i.name="FullHealthBar";var a=new THREE.BoxGeometry(this._healthBarWidth,.2,.2),n=new THREE.MeshBasicMaterial({color:16711680}),r=new THREE.Mesh(a,n);r.name="EmptyHealthBar";var s=new THREE.Group;return s.add(i),s.add(r),s.position.y=4,s}},{key:"isObjectLoaded",value:function(e){return 0===e.position.x&&0===e.position.y&&0===e.position.z}},{key:"registerCollision",value:function(){var e=this;this.hitBox.geometry.computeBoundingBox();var t=this.hitBox.geometry.boundingBox.clone();this.collider=new THREEx.ColliderBox3(this.hitBox,t),this.colliderList.push(this.collider),this.collider.addEventListener("contactEnter",function(t){var i=t.object3d.userData;i.player.id!==e.playerId&&(i.ranged||(e.speed=0,e.attack=!0,e.currentTarget=i.object,e.resetWalkAnimation()))}),this.collider.addEventListener("contactStay",function(t){var i=t.object3d.userData;i.player.id!==e.playerId&&(i.ranged||null===e.currentTarget&&(e.speed=0,e.attack=!0,e.currentTarget=i.object,e.resetWalkAnimation()))}),this.collider.addEventListener("contactRemoved",function(t){e.speed=e.defaultSpeed,e.attack=!1,e.currentTarget=null}),this.collider.addEventListener("contactExit",function(t){e.speed=e.defaultSpeed,e.attack=!1,e.currentTarget=null})}},{key:"getAttackValue",value:function(){return Math.random()>=.9?this.attackStrength*(Math.random()+1):this.attackStrength}},{key:"updateHealthBar",value:function(){var e=this.health/this.maxHealth,t=-(1-e)*this._healthBarWidth/2,i=this.healthBar.getObjectByName("FullHealthBar");i.scale.x=e,i.position.x=t}},{key:"runLoop",value:function(e){this.attackProcedure(e),this.viewObj.position.x+=this.speed*this.direction,this.walkProcedure(e),this.collider.update(),this.updateHealthBar()}},{key:"attackProcedure",value:function(e){if(!(this.health<=0)){if(null!=this.attackProperties.lastTimeStamp&&this.attack){var t=e-this.attackProperties.lastTimeStamp;this.attackProperties.attackTime=this.attackProperties.attackTime+t,this.attackProperties.lastTimeStamp=e,this.attackLoop(t)}else this.attack&&(this.attackProperties.attackTime=0,this.attackProperties.lastTimeStamp=e,this.attackLoop(0));this.attackProperties.lastTimeStamp=e}}},{key:"attackLoop",value:function(e){null!==this.currentTarget&&this.currentTarget.playerId!==this.playerId&&(this.animateAttack(e),this.attackProperties.attackTime<=this.attackSpeed||(this.currentTarget.health-=this.getAttackValue(),this.currentTarget.health<=0&&(this.player.processReward(this.currentTarget.killReward),this.currentTarget.attack=!1,this.currentTarget.destroy=!0,this.currentTarget=null),this.attackProperties.attackTime=0,this.attackProperties.lastTimeStamp=null))}},{key:"animateAttack",value:function(e){if(this.viewObj.children.length>1){var t=this.viewObj.children[1].children[1],i=this.attackProperties.attackTime,a=this.attackAnimationProperties.direction,n=this.attackAnimationProperties.speed,r=a*(Math.PI/180*135*(e/n));r=Math.min(t.rotation.z+r,135),r=Math.max(r,0),t.rotation.z=r,this.attackAnimationProperties.direction=i>n?-1:1}}},{key:"resetAttackAnimation",value:function(){if(this.viewObj.children.length>1){this.viewObj.children[1].children[1].rotation.z=0}}},{key:"walkProcedure",value:function(e){if(this.attack||null===this.walkingAnimationProperties.lastTimeStamp)this.walkLoop(0);else{var t=e-this.walkingAnimationProperties.lastTimeStamp;this.walkingAnimationProperties.time=this.walkingAnimationProperties.time+t,this.walkLoop(t)}this.walkingAnimationProperties.lastTimeStamp=e}},{key:"walkLoop",value:function(e){this.animateWalk(e),this.walkingAnimationProperties.time<=this.walkingAnimationProperties.speed||(this.walkingAnimationProperties.time=0)}},{key:"animateWalk",value:function(e){if(this.viewObj.children.length>1&&!this.attack){var t=this.viewObj.children[1].children[3],i=t.children[0],a=t.children[1],n=(this.walkingAnimationProperties.time,this.walkingAnimationProperties.speed),r=this.walkingAnimationProperties.direction,s=e/n*45;r?(this.animateLegForward(i,s,45,e),this.animateLegBack(a,s,45,e)):(this.animateLegForward(a,s,45,e),this.animateLegBack(i,s,45,e)),(this.toDegrees(i.rotation.z)>=45||this.toDegrees(i.rotation.z)<=-45)&&(this.walkingAnimationProperties.direction=!this.walkingAnimationProperties.direction)}}},{key:"animateLegBack",value:function(e,t,i,a){var n=this.toRadians(-i);e.rotation.z+this.toRadians(-t)<n?e.rotation.z=n:e.rotation.z+=this.toRadians(-t)}},{key:"animateLegForward",value:function(e,t,i,a){var n=this.toRadians(i);e.rotation.z+this.toRadians(t)>n?e.rotation.z=n:e.rotation.z+=this.toRadians(t)}},{key:"resetWalkAnimation",value:function(){if(this.viewObj.children.length>1){var e=this.viewObj.children[1].children[3],t=e.children[0],i=e.children[1];t.rotation.z=0,i.rotation.z=0}}},{key:"toDegrees",value:function(e){return 180*e/Math.PI}},{key:"toRadians",value:function(e){return e/180*Math.PI}}]),e}();i.default=o},{"./constants":5}],10:[function(e,t,i){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function n(e,t){
if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}(),s=e("./minion"),o=a(s),l=e("./archer"),h=a(l),c=e("./base"),d=a(c),u=e("./constants"),m=function(){function e(t){n(this,e),this.type=t.type,this.id=t.id,this.direction=t.direction,this.colliderList=t.colliderList,this.colliderSystem=t.colliderSystem,this.scene=t.scene,this.minionId=0,this.spawnPos=-u.gridWidth/2*this.direction,this.setUpgradeValues(),this.loader=new THREE.ObjectLoader,this.setupGameState(),this.spawnBase(),this.spawnArchers()}return r(e,[{key:"spawnArchers",value:function(){var e=this,t=new h.default({scene:this.scene,colliderList:this.colliderList,startingZ:2,startingY:20,startingX:this.spawnPos,direction:this.direction,player:this});this.archers.push(t),this.loader.load("./geometry/wizard.json",function(i){i.position.y=-4,t.viewObj.add(i),t.bodyModel=t.viewObj.children[2],t.rightArm=t.bodyModel.children[1],t.rightArm.rotation.z=.75*Math.PI,t.direction===-1&&(t.viewObj.children[2].rotation.y=Math.PI,t.startingRotation=Math.PI),e.scene.add(t.viewObj)})}},{key:"spawnBase",value:function(){this.base=new d.default({direction:this.direction,colliderList:this.colliderList,player:this}),this.scene.add(this.base.viewObj)}},{key:"spawnMinion",value:function(e){var t=this;if(this.money>=this.minionCost){this.gameOver||(this.money-=this.minionCost);var i=new o.default({id:this.minionId++,healthUpgrade:this.upgrades.minionBaseHealth,attackUpgrade:this.upgrades.minionBaseAttack,attackSpeedUpgrade:this.upgrades.minionBaseAttackSpeed,playerId:this.id,direction:this.direction,startingZ:e,colliderList:this.colliderList,player:this});this.minions.push(i),this.loader.load("./geometry/model.json",function(e){e.position.y=-4,i.viewObj.add(e),i.direction===-1&&(i.viewObj.children[1].rotation.y=Math.PI),t.scene.add(i.viewObj)})}}},{key:"processReward",value:function(e){if(!this.gameOver){var t=this;Object.keys(e).forEach(function(i){t[i]+=e[i]})}}},{key:"runLoop",value:function(e){var t=this;null!==this.base&&(this.base.runLoop(),this.base.destroy&&this.destroyBase()),this.archers.forEach(function(t){t.runLoop(e)}),this.minions.forEach(function(i,a){i.runLoop(e),i.attack||i.resetAttackAnimation(),i.destroy&&t.destroyMinion(i,a)}),this.colliderSystem.computeAndNotify(this.colliderList)}},{key:"destroyMinion",value:function(e,t){this.scene.remove(e.viewObj),this.colliderList.splice(this.findColliderIndex(e.collider.id),1),e.collider.removeEventListener("contactEnter"),e.collider.removeEventListener("contactStay"),e.collider.removeEventListener("contactExit"),e.collider.removeEventListener("contactRemoved"),this.minions.splice(t,1)}},{key:"destroyBase",value:function(){var e=this;this.archers.forEach(function(t){e.scene.remove(t.viewObj),e.colliderList.splice(e.findColliderIndex(t.collider.id),1)}),this.archers.length=0,this.scene.remove(this.base.viewObj),this.colliderList.splice(this.findColliderIndex(this.base.collider.id),1),this.base=null,this.lost=!0}},{key:"findColliderIndex",value:function(e){for(var t=-1,i=0;i<this.colliderList.length;i++)this.colliderList[i].id===e&&(t=i);return t}},{key:"setGameOver",value:function(){this.gameOver=!0}},{key:"reset",value:function(){var e=this;this.minions.forEach(function(t){e.scene.remove(t.viewObj)}),this.base&&(this.scene.remove(this.base.viewObj),this.base=null),this.archers.forEach(function(t){e.scene.remove(t.viewObj)}),this.gameOver=!1,this.setUpgradeValues(),this.setupGameState(),this.spawnBase(),this.spawnArchers()}},{key:"setupGameState",value:function(){this.minions=[],this.archers=[],this.score=0,this.money=4e3,this.minionCost=50,this.lost=!1}},{key:"setUpgradeValues",value:function(){this.upgrades={minionBaseHealth:0,minionBaseAttack:0,minionBaseAttackSpeed:0,archerBaseAttack:0,archerBaseAttackSpeed:0}}}]),e}();i.default=m},{"./archer":3,"./base":4,"./constants":5,"./minion":9}],11:[function(e,t,i){"use strict";function a(e,t){var i=window.innerWidth,a=window.innerHeight;e.setSize(i,a),t.aspect=i/a,t.updateProjectionMatrix()}function n(e,t){window.addEventListener("resize",function(){a(e,t)})}function r(){var e=new THREE.Scene,t=new THREE.PerspectiveCamera(70,window.innerWidth/window.innerHeight,.1,1e3),i=new THREE.WebGLRenderer;return i.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(i.domElement),n(i,t),{scene:e,camera:t,renderer:i}}function s(){var e=new THREEx.RendererStats;return e.domElement.style.position="absolute",e.domElement.style.left="0px",e.domElement.style.bottom="0px",document.body.appendChild(e.domElement),e}Object.defineProperty(i,"__esModule",{value:!0}),i.setupScreenView=r,i.setupPerformance=s},{}]},{},[1]);
//# sourceMappingURL=maps/app.js.map
