!function e(t,i,n){function a(s,o){if(!i[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(r)return r(s,!0);var h=new Error("Cannot find module '"+s+"'");throw h.code="MODULE_NOT_FOUND",h}var c=i[s]={exports:{}};t[s][0].call(c.exports,function(e){var i=t[s][1][e];return a(i||e)},c,c.exports,e,t,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)a(n[s]);return a}({1:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e-w;t/=1e3,w=e;var i=Math.round(1/t);requestAnimationFrame(a),p.renderLoop(e),r(i),u.renderer.render(u.scene,u.camera),m.update(u.renderer)}function r(e){f.textContent=d.myPlayer.score,v.textContent=d.myPlayer.money,y.textContent=e}var s=e("./modules/view"),o=e("./modules/game-engine"),l=n(o),h=e("./modules/game-view"),c=n(h),u=void 0,d=void 0,p=void 0,f=void 0,v=void 0,y=void 0,m=new THREEx.RendererStats;m.domElement.style.position="absolute",m.domElement.style.left="0px",m.domElement.style.bottom="0px",document.body.appendChild(m.domElement);var w=0;!function(){var e=(0,s.setupScreenView)(),t=e.scene,i=e.camera,n=e.renderer;u={scene:t,camera:i,renderer:n},d=new l.default(u),p=new c.default(u,d),f=document.getElementById("score"),v=document.getElementById("money"),y=document.getElementById("fps"),window.addEventListener("click",function(){var e=p.getCurrentPanelIndex();e>=0&&d.myPlayer.spawnMinion(e)}),window.addEventListener("keypress",function(){d.computer.spawnMinion(3)}),a()}()},{"./modules/game-engine":5,"./modules/game-view":6,"./modules/view":10}],2:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=e("./constants");Array.prototype.unique=function(){return this.filter(function(e,t,i){return i.indexOf(e)===t})};var s=function(){function e(t){n(this,e),this.determineAIFunction(t.personality),this.player=t.player,this.spawnInterval=500,this.lastSpawn=0,this.poppulationLimit=500}return a(e,[{key:"canSpawn",value:function(e){return e-this.lastSpawn>this.spawnInterval}},{key:"runLoop",value:function(e,t){if(this.canSpawn(e)){var i=this.AIFunction(t,this.player.minions);i>=0&&this.player.minions.length<this.poppulationLimit&&(this.player.spawnMinion(i),this.lastSpawn=e)}}},{key:"randomAI",value:function(e){return Math.floor(Math.random()*r.gridSubDiv)}},{key:"nicksAI",value:function(e,t){for(var i=this.player.spawnPos,n=t.map(function(e){return{row:e.startingZ,distance:e.getPosition().x-i}}),a=e.map(function(e){var t=i-e.getPosition().x;return{row:e.startingZ,distance:t}}),s=[],o=0;o<r.gridSubDiv;o++)s.push(o);var l={hasFriendlies:[],closestIndex:-1,closestVal:99999,distanceTies:[]};n.forEach(function(e,t){l.hasFriendlies.push(e.row)}),a.forEach(function(e,t){e.distance<l.closestVal?(l.closestIndex=e.row,l.closestVal=e.distance,l.distanceTies.length>0&&(l.distanceTies.length=0)):e.distance===l.closestVal&&l.distanceTies.push(e.row)}),l.distanceTies.push(l.closestIndex),l.hasFriendlies=l.hasFriendlies.unique();var h=s.slice(0);l.gaps=h.filter(function(e){return l.hasFriendlies.indexOf(e)<0});var c=void 0;return c=l.closestVal<r.gridWidth/2?l.distanceTies:l.gaps,c[Math.floor(Math.random()*c.length)]}},{key:"defensiveAI",value:function(e){for(var t={},i=0;i<r.gridSubDiv;i++)t[i]=0;e.forEach(function(e){t[e.startingZ]--}),this.player.minions.forEach(function(e){t[e.startingZ]++});var n=-1,a=1e5;return Object.values(t).forEach(function(e,t){e<a&&(a=e,n=t)}),n}},{key:"determineAIFunction",value:function(e){this.AIFunction=e?this[e]:this.randomAI}}]),e}();i.default=s},{"./constants":4}],3:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=e("./constants"),s=function(){function e(t){n(this,e),this.direction=t.direction,this.colliderList=t.colliderList,this.player=t.player,this.playerId=this.player.id,this.baseWidth=r.gridWidth,this.baseHeight=20,this.baseDepth=10,this.maxHealth=5e3,this.health=this.maxHealth,this.hitBoxBuffer=2,this.killReward={money:550,score:1e3},this.initializeView(this.direction),this.registerCollision()}return a(e,[{key:"initializeView",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.25;this.viewObj=new THREE.Group;var i=new THREE.BoxGeometry(this.baseDepth,this.baseHeight,this.baseWidth),n=new THREE.MeshPhongMaterial({color:34816,specular:5592405,shininess:30}),a=new THREE.Mesh(i,n),s=new THREE.BoxGeometry(this.baseDepth+this.hitBoxBuffer,this.baseHeight+this.hitBoxBuffer,this.baseWidth+this.hitBoxBuffer),o=new THREE.MeshBasicMaterial({color:65535,transparent:!0,opacity:t}),l=new THREE.Mesh(s,o);this.healthBar=this.initializeHealthBar(),this.hitBox=l,this.viewObj.add(a),this.viewObj.add(l),this.viewObj.add(this.healthBar),this.viewObj.position.x=(-r.gridWidth/2-this.baseDepth/2)*this.direction,this.viewObj.position.y=this.baseHeight/2,this.hitBox.userData.object=this,this.hitBox.userData.player=this.player}},{key:"initializeHealthBar",value:function(){this._healthBarLength=r.gridWidth/10,this._healthBarWidth=r.gridWidth/150;var e=new THREE.BoxGeometry(this._healthBarLength,this._healthBarWidth,this._healthBarWidth),t=new THREE.MeshBasicMaterial({color:65280}),i=new THREE.Mesh(e,t);i.name="FullHealthBar";var n=new THREE.BoxGeometry(.99*this._healthBarLength,.9*this._healthBarWidth,.9*this._healthBarWidth),a=new THREE.MeshBasicMaterial({color:16711680}),s=new THREE.Mesh(n,a);s.name="EmptyHealthBar";var o=new THREE.Group;return o.add(i),o.add(s),o.position.y=this.baseHeight+5,o}},{key:"updateHealthBar",value:function(){var e=this.health/this.maxHealth,t=-(1-e)*this._healthBarLength/2,i=this.healthBar.getObjectByName("FullHealthBar");i.scale.x=e,i.position.x=t}},{key:"registerCollision",value:function(){this.hitBox.geometry.computeBoundingBox();var e=this.hitBox.geometry.boundingBox.clone();this.collider=new THREEx.ColliderBox3(this.hitBox,e),console.log(this.colliderList),this.colliderList.push(this.collider)}},{key:"runLoop",value:function(){this.collider.update(),this.updateHealthBar()}}]),e}();i.default=s},{"./constants":4}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.xPositive=1,i.xNegative=-1,i.gridWidth=64,i.gridSubDiv=16},{}],5:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("./player"),o=n(s),l=e("./ai-player"),h=n(l),c=e("./menu-screen"),u=e("./constants"),d=function(){function e(t){a(this,e),this.state={},this.scene=t.scene,this.camera=t.camera,this.colliderSystem=new THREEx.ColliderSystem,this.colliderList=[],this.playerId=0,this.initializePlayers()}return r(e,[{key:"initializePlayers",value:function(){this.myPlayer=new o.default({type:"human",direction:u.xPositive,colliderList:this.colliderList,scene:this.scene,id:this.playerId++}),this.computer=new o.default({type:"computer",direction:u.xNegative,colliderList:this.colliderList,scene:this.scene,id:this.playerId++}),this.AI=new h.default({player:this.computer,personality:"nicksAI"}),this.playerAI=new h.default({player:this.myPlayer,personality:"nicksAI"}),this.state.players=[this.myPlayer,this.computer]}},{key:"initializeGameOver",value:function(){(0,c.activateMenu)({winner:this.winner})}},{key:"restart",value:function(){for(;this.colliderList.length>0;)this.colliderList.pop();this.state.players.forEach(function(e){e.reset()}),this.gameOver=!1}},{key:"gameLoop",value:function(e){var t=this;this.gameOver,this.AI&&this.AI.runLoop(e,this.myPlayer.minions),this.playerAI&&this.playerAI.runLoop(e,this.computer.minions),this.state.players.forEach(function(i){i.runLoop(e),i.lost&&!t.gameOver&&(t.gameOver=!0,t.winner=i.id!==t.myPlayer.id,t.initializeGameOver())}),this.colliderSystem.computeAndNotify(this.colliderList)}}]),e}();i.default=d},{"./ai-player":2,"./constants":4,"./menu-screen":7,"./player":9}],6:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=e("./constants"),s=e("./menu-screen"),o=(new THREE.TextureLoader).load("textures/stone.jpg");o.repeat.set(10,10),o.wrapS=THREE.RepeatWrapping,o.wrapT=THREE.RepeatWrapping;var l=function(){function e(t,i){n(this,e),this.scene=t.scene,this.camera=t.camera,this.renderer=t.renderer,this.gameEngine=i,this.setupGrid(),this.setupLight(),this.mouse={x:-1e4,y:0};var a=r.gridWidth/2;this.camera.position.z=2*a,this.camera.position.y=1.5*a,this.camera.lookAt(this.scene.position),this.raycaster=new THREE.Raycaster,this.currentHoveredPanel=null,this.setupMouseEvent(),(0,s.bindButtons)(this.gameEngine)}return a(e,[{key:"setupLight",value:function(){var e=new THREE.AmbientLight(6710886,3),t=new THREE.PointLight(8947848);t.position.set(3,3,3),this.scene.add(e),this.scene.add(t)}},{key:"setupGrid",value:function(){var e=new THREE.PlaneGeometry(r.gridWidth,r.gridWidth),t=new THREE.MeshBasicMaterial({map:o}),i=new THREE.Mesh(e,t);i.rotation.x=-.5*Math.PI,i.position.y=-.3,this.scene.add(i);var n=new THREE.GridHelper(r.gridWidth,r.gridSubDiv);this.scene.add(n),this.gridPanels={};for(var a=r.gridWidth/r.gridSubDiv,s=(r.gridWidth/2-a/2)*-1,l=0;l<r.gridSubDiv;l++){var h=new THREE.PlaneGeometry(r.gridWidth,a),c=new THREE.MeshBasicMaterial({transparent:!0,opacity:0}),u=new THREE.Mesh(h,c);u.rotation.x=-.5*Math.PI,u.position.z=s,u.position.y=-.2,this.scene.add(u),this.gridPanels[l]=u,s+=a}}},{key:"checkGridIntersections",value:function(){this.raycaster.setFromCamera(this.mouse,this.camera);var e=Object.values(this.gridPanels),t=this.raycaster.intersectObjects(e);if(e.forEach(function(e){e.material.color.setHex(6710886),e.material.opacity=0}),t.length>0){var i=t[0].object;i.material.color.setHex(16711680),i.material.opacity=.5,this.currentHoveredPanel=i}else this.currentHoveredPanel&&(this.currentHoveredPanel=null)}},{key:"getCurrentPanelIndex",value:function(){if(this.currentHoveredPanel)for(var e=Object.values(this.gridPanels),t=0;t<r.gridSubDiv;t++)if(this.currentHoveredPanel===e[t])return t}},{key:"setupMouseEvent",value:function(){var e=this.mouse;window.addEventListener("mousemove",function(t){e.x=event.clientX/window.innerWidth*2-1,e.y=2*-(event.clientY/window.innerHeight)+1})}},{key:"renderLoop",value:function(e){this.checkGridIntersections(),this.gameEngine.gameLoop(e)}}]),e}();i.default=l},{"./constants":4,"./menu-screen":7}],7:[function(e,t,i){"use strict";function n(){h.classList.add("modal--visible"),c.classList.remove("modal--visible")}function a(e){h.classList.remove("modal--visible"),c.classList.add("modal--visible")}function r(e){l.classList.add("modal--visible"),null!==e.winner?a(e.winner):n()}function s(e){l.classList.remove("modal--visible")}function o(e){h.addEventListener("click",function(){}),c.addEventListener("click",function(){e.restart(),s()})}Object.defineProperty(i,"__esModule",{value:!0}),i.activateMenu=r,i.closeMenu=s,i.bindButtons=o;var l=document.getElementById("modal"),h=document.getElementById("startModal"),c=document.getElementById("restartModal")},{}],8:[function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var a=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=e("./constants"),s=function(){function e(t){n(this,e),this.direction=t.direction,this.colliderList=t.colliderList,this.id=t.id,this.playerId=t.playerId,this.player=t.player,this.startingZ=t.startingZ,this.scene=t.scene,this.maxHealth=10,this.health=this.maxHealth,this.attackStrength=3,this.attackSpeed=400,this.defaultSpeed=.3,this.speed=this.defaultSpeed,this.attackProperties={lastTimeStamp:null,attackTime:0},this.killReward={money:15,score:10},this.destroy=!1,this.attack=!1,this.initializeView(this.startingZ),this.registerCollision()}return a(e,[{key:"initializeView",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.25;this.viewObj=new THREE.Group;var i=new THREE.BoxGeometry(3,8,3),n=new THREE.MeshBasicMaterial({color:65535,transparent:!0,opacity:t}),a=new THREE.Mesh(i,n);this.healthBar=this.initializeHealthBar(),a.add(this.healthBar),this.viewObj=a,this.hitBox=this.viewObj;var s=e*(r.gridWidth/r.gridSubDiv)-r.gridWidth/2+r.gridWidth/r.gridSubDiv/2,o=r.gridWidth/2*-this.direction;this.viewObj.position.z=s,this.viewObj.position.x=o,this.viewObj.position.y=4,this.hitBox.userData.object=this,this.hitBox.userData.player=this.player}},{key:"getPosition",value:function(){return this.viewObj.position}},{key:"initializeHealthBar",value:function(){this._healthBarWidth=2;var e=new THREE.BoxGeometry(this._healthBarWidth,.3,.3),t=new THREE.MeshBasicMaterial({color:65280}),i=new THREE.Mesh(e,t);i.name="FullHealthBar";var n=new THREE.BoxGeometry(this._healthBarWidth,.2,.2),a=new THREE.MeshBasicMaterial({color:16711680}),r=new THREE.Mesh(n,a);r.name="EmptyHealthBar";var s=new THREE.Group;return s.add(i),s.add(r),s.position.y=4,s}},{key:"isObjectLoaded",value:function(e){return 0===e.position.x&&0===e.position.y&&0===e.position.z}},{key:"registerCollision",value:function(){var e=this;this.hitBox.geometry.computeBoundingBox();var t=this.hitBox.geometry.boundingBox.clone();this.collider=new THREEx.ColliderBox3(this.hitBox,t),this.colliderList.push(this.collider),this.collider.addEventListener("contactEnter",function(t){t.object3d.userData.player.id!==e.playerId&&(e.speed=0,e.attack=!0,e.currentTarget=t.object3d.userData.object)}),this.collider.addEventListener("contactStay",function(t){t.object3d.userData.player.id!==e.playerId&&null===e.currentTarget&&(e.speed=0,e.attack=!0,e.currentTarget=t.object3d.userData.object)}),this.collider.addEventListener("contactRemoved",function(t){e.speed=e.defaultSpeed,e.attack=!1,e.currentTarget=null})}},{key:"getAttackValue",value:function(){return Math.random()*this.attackStrength}},{key:"updateHealthBar",value:function(){var e=this.health/this.maxHealth,t=-(1-e)*this._healthBarWidth/2,i=this.healthBar.getObjectByName("FullHealthBar");i.scale.x=e,i.position.x=t}},{key:"runLoop",value:function(e){this.attackProcedure(e),this.viewObj.position.x+=this.speed*this.direction,this.collider.update(),this.updateHealthBar()}},{key:"attackProcedure",value:function(e){if(!(this.health<=0)){if(null!=this.attackProperties.lastTimeStamp&&this.attack){var t=e-this.attackProperties.lastTimeStamp;this.attackProperties.attackTime+=t,this.attackProperties.lastTimeStamp=e,this.attackLoop()}else this.attack&&(this.attackProperties.attackTime=0,this.attackProperties.lastTimeStamp=e,this.attackLoop());this.attackProperties.lastTimeStamp=e}}},{key:"attackLoop",value:function(){null!==this.currentTarget&&this.currentTarget.playerId!==this.playerId&&(this.attackProperties.attackTime<this.attackSpeed||(this.animateAttack(),this.currentTarget.health-=this.getAttackValue(),this.currentTarget.health<=0&&(this.player.processReward(this.currentTarget.killReward),this.currentTarget.attack=!1,this.currentTarget.destroy=!0,this.currentTarget=null),this.attackProperties.attackTime=0,this.attackProperties.lastTimeStamp=null))}},{key:"animateAttack",value:function(){if(this.viewObj.children.length>1){this.viewObj.children[1].children[1].rotation.z=.5*Math.PI}}}]),e}();i.default=s},{"./constants":4}],9:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(i,"__esModule",{value:!0});var r=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=e("./minion"),o=n(s),l=e("./base"),h=n(l),c=e("./constants"),u=function(){function e(t){a(this,e),this.type=t.type,this.id=t.id,this.direction=t.direction,this.colliderList=t.colliderList,this.scene=t.scene,this.minionId=0,this.spawnPos=-c.gridWidth/2*this.direction,this.setupGameState(),this.spawnBase()}return r(e,[{key:"spawnBase",value:function(){this.base=new h.default({direction:this.direction,colliderList:this.colliderList,player:this}),this.scene.add(this.base.viewObj)}},{key:"spawnMinion",value:function(e){var t=this;if(this.money>=this.minionCost){this.money-=this.minionCost;var i=new o.default({id:this.minionId++,playerId:this.id,direction:this.direction,startingZ:e,colliderList:this.colliderList,player:this});this.minions.push(i);new THREE.BoxGeometry(2,2,2);(new THREE.ObjectLoader).load("../geometry/model.json",function(e){console.log(e),e.position.y=-4,i.viewObj.add(e),t.scene.add(i.viewObj)})}}},{key:"processReward",value:function(e){var t=this;Object.keys(e).forEach(function(i){t[i]+=e[i]})}},{key:"runLoop",value:function(e){var t=this;null!==this.base&&(this.base.runLoop(),this.base.destroy&&this.destroyBase()),this.minions.forEach(function(i,n){i.runLoop(e),i.destroy&&t.destroyMinion(i,n)})}},{key:"destroyMinion",value:function(e,t){this.scene.remove(e.viewObj),this.colliderList.splice(this.findColliderIndex(e.collider.id),1),this.minions.splice(t,1)}},{key:"destroyBase",value:function(){this.scene.remove(this.base.viewObj),this.colliderList.splice(this.findColliderIndex(this.base.collider.id),1),this.base=null,this.lost=!0}},{key:"findColliderIndex",value:function(e){for(var t=-1,i=0;i<this.colliderList.length;i++)this.colliderList[i].id===e&&(t=i);return t}},{key:"reset",value:function(){var e=this;this.minions.forEach(function(t){e.scene.remove(t.viewObj)}),this.base&&(this.scene.remove(this.base.viewObj),this.base=null),this.spawnBase(),this.setupGameState()}},{key:"setupGameState",value:function(){this.minions=[],this.score=0,this.money=4e3,this.minionCost=20,this.lost=!1}}]),e}();i.default=u},{"./base":3,"./constants":4,"./minion":8}],10:[function(e,t,i){"use strict";function n(e,t){var i=window.innerWidth,n=window.innerHeight;e.setSize(i,n),t.aspect=i/n,t.updateProjectionMatrix()}function a(e,t){window.addEventListener("resize",function(){n(e,t)})}function r(){var e=new THREE.Scene,t=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3),i=new THREE.WebGLRenderer;return i.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(i.domElement),a(i,t),{scene:e,camera:t,renderer:i}}Object.defineProperty(i,"__esModule",{value:!0}),i.setupScreenView=r},{}]},{},[1]);
//# sourceMappingURL=maps/app.js.map
